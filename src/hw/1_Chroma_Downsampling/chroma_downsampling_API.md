
---

##  模組名稱：`chroma_downsampling`

---

### 1️⃣ Input（輸入）

| 名稱              | 寬度           | 說明                      |
| --------------- | ------------ | ----------------------- |
| `aclk`          | 1            | 時脈輸入                    |
| `aresetn`       | 1            | 非同步負緣 Reset（低有效）        |
| `s_axis_tdata`  | `DATA_WIDTH` | 輸入資料流（AXI-Stream）單一像素資料 |
| `s_axis_tvalid` | 1            | 資料有效旗標（由上游提供）           |
| `s_axis_tlast`  | 1            | AXIS frame 的結尾指示        |

---

### 2️⃣ Output（輸出）

| 名稱              | 寬度           | 說明                |
| --------------- | ------------ | ----------------- |
| `s_axis_tready` | 1            | 模組準備好接收輸入資料       |
| `m_axis_tdata`  | `DATA_WIDTH` | 經過下採樣處理後的輸出資料     |
| `m_axis_tvalid` | 1            | 輸出資料有效            |
| `m_axis_tlast`  | 1            | 輸出 frame 結尾（最後一筆） |

---

### 3️⃣ Method（處理方法）

此模組根據 JPEG 的 Chroma Downsampling 需求進行資料處理，流程如下：

####  資料流程分為 4 個 FSM 狀態：

1. **STATE\_IDLE**

   * 初始化所有暫存器與狀態

2. **STATE\_RECEIVE**

   * 依序接收 AXIS 流中的 768 筆資料

     * 前 256 筆：Y（亮度）
     * 接著 256 筆：Cb（藍色色差）
     * 最後 256 筆：Cr（紅色色差）

3. **STATE\_PROCESS**

   * Y 資料直接複製至輸出緩衝區（保持完整）
   * 對 Cb 與 Cr 執行 **2×2 區塊平均**，產生各 64 筆資料（即從 8×8 轉為 4×4）
   * 合計產出 256（Y）+ 64（Cb）+ 64（Cr）= **384 筆輸出**

4. **STATE\_SEND**

   * 將處理完成的 384 筆資料送出，透過 AXI-Stream

---

### 4️⃣ Use Case（應用場景）

| 應用                              | 說明                                               |
| ------------------------------- | ------------------------------------------------ |
|  JPEG 影像壓縮前處理                 | 適用於將 MCU 內的色彩資訊做 4:2:0 下採樣處理，以減少資料量並符合 JPEG 編碼規格 |
|  與 AXI-Stream JPEG Encoder 串接 | 可作為上游處理模組，與 DCT 模組、Huffman 模組搭配使用                |
| DMA 驅動驗證用                    | 可搭配 SDK 驗證 DMA 傳輸與 Stream 接收是否成功進行處理             |

---

### 5️⃣ Attributes（模組特性）

| 特性                     | 說明                                        |
| ---------------------- | ----------------------------------------- |
|  **AXI-Stream 相容設計** | 遵循 `tvalid / tready / tlast` 通訊協定         |
|  **低延遲處理**           | 一次處理 768 筆資料，分階段完成壓縮                 |
|  **自動判斷結束**          | 根據 input count 決定何時進入處理與輸出階段，無需外部介入       |
|  **資料封裝緊湊**          | 輸出為 384 筆資料：Y(256) + Cb(64) + Cr(64)，精準控制 |
|  **無需額外記憶體控制**       | 所有緩衝皆為內部暫存，簡化整合設計                         |

---

