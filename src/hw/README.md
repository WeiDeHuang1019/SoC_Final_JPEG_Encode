
# JPEG å£“ç¸®æ¨¡çµ„ç¸½è¦½èˆ‡åŸç†èªªæ˜

æœ¬å°ˆæ¡ˆå¯¦ä½œ JPEG å£“ç¸®æµç¨‹ä¸­çš„ä¸‰å¤§æ¨¡çµ„ï¼ŒåŒ…å«ï¼š

- Chroma Downsampling æ¨¡çµ„
- 2D DCT + Quantization æ¨¡çµ„
- Zig-Zag + RLE + Huffman ç·¨ç¢¼æ¨¡çµ„

---

## ğŸ”² æ¨¡çµ„ 1ï¼šChroma Downsampling æ¨¡çµ„

### æ¨¡çµ„åŠŸèƒ½èªªæ˜

åœ¨ JPEG å£“ç¸®ä¸­ï¼Œäººçœ¼å°æ˜äº®åº¦ï¼ˆLuminance, Yï¼‰è¼ƒæ•æ„Ÿï¼Œå°è‰²åº¦ï¼ˆChrominance, Cb/Crï¼‰è¼ƒä¸æ•æ„Ÿï¼Œå› æ­¤å° Cb èˆ‡ Cr åˆ†é‡é€²è¡Œ **4:2:0 ä¸‹æ¡æ¨£** å¯æœ‰æ•ˆå£“ç¸®è³‡æ–™é‡ã€‚

æœ¬æ¨¡çµ„åŠŸèƒ½ç‚ºï¼š
- æ¥æ”¶ YCbCr è³‡æ–™æµ
- å° Cbã€Cr åˆ†é‡é€²è¡Œ **8Ã—8 â†’ 4Ã—4** ä¸‹æ¡æ¨£
- ä¿ç•™ Y åˆ†é‡å®Œæ•´

---

### åŸç†èˆ‡æ•¸å­¸å…¬å¼

å°æ¯å€‹ 8Ã—8 çš„ Cb æˆ– Cr å€å¡Šï¼Œé€²è¡Œ 2Ã—2 å¹³å‡åˆä½µï¼š

$$
Cb'_{i,j} = \frac{1}{4} \left( Cb_{2i,2j} + Cb_{2i,2j+1} + Cb_{2i+1,2j} + Cb_{2i+1,2j+1} \right)
$$

çµæœç‚ºä¸€å€‹ 4Ã—4 å€å¡Šï¼ˆå…± 16 å€‹åƒç´ ï¼‰ã€‚

---

### MCUï¼ˆæœ€å°ç·¨ç¢¼å–®å…ƒï¼‰å®šç¾©

- æ¯å€‹ MCU å°æ‡‰ **16Ã—16 åƒç´ **
  - Y åˆ†é‡ â†’ åˆ‡ç‚º 4 å€‹ 8Ã—8 å€å¡Š
  - Cb/Cr â†’ ä»¥ 2Ã—2 åˆä½µ â†’ ç”Ÿæˆ 8Ã—8 è‰²åº¦å€å¡Šï¼ˆdownsampledï¼‰

---

## ğŸ”²æ¨¡çµ„ 2ï¼š2D DCT + Quantization æ¨¡çµ„

### æ¨¡çµ„åŠŸèƒ½èªªæ˜

DCTï¼ˆDiscrete Cosine Transformï¼‰å°‡åƒç´ å¾ç©ºé–“åŸŸè½‰æ›ç‚ºé »åŸŸï¼Œæ˜¯ JPEG çš„æ ¸å¿ƒæ­¥é©Ÿã€‚å°æ¯å€‹ 8Ã—8 å€å¡Šé€²è¡Œ 2D DCT å¾Œï¼Œä½¿ç”¨æ¨™æº–é‡åŒ–è¡¨å°çµæœé€²è¡Œ**æœ‰æå£“ç¸®**ã€‚

---

### DCT æ•¸å­¸å…¬å¼

#### DCT-IIï¼ˆ8Ã—8ï¼‰ï¼š

$$
F(u,v) = \frac{1}{4} C(u) C(v) \sum_{x=0}^{7} \sum_{y=0}^{7} f(x,y) \cos\left( \frac{(2x+1)u\pi}{16} \right) \cos\left( \frac{(2y+1)v\pi}{16} \right)
$$

å…¶ä¸­ï¼š

$$
C(w) = \begin{cases}
\frac{1}{\sqrt{2}}, & w = 0 \\
1, & w > 0
\end{cases}
$$

---

### çŸ©é™£åŒ–è¡¨ç¤º

ä»¤ $X$ ç‚ºè¼¸å…¥ 8Ã—8 å€å¡Šï¼š

$$
F = A \cdot X \cdot A^T
$$

- $A$ ç‚º DCT åŸºåº•çŸ©é™£
- $A^T$ ç‚ºå…¶è½‰ç½®



---

### é‡åŒ–å…¬å¼

å°‡ DCT çµæœé™¤ä»¥å°æ‡‰çš„é‡åŒ–è¡¨ Qï¼Œå†å››æ¨äº”å…¥ï¼š

$$
F_q(u,v) = \text{round} \left( \frac{F(u,v)}{Q(u,v)} \right)
$$

---

## ğŸ”²æ¨¡çµ„ 3ï¼šZig-Zag + RLE + Huffman ç·¨ç¢¼æ¨¡çµ„

### æ¨¡çµ„åŠŸèƒ½èªªæ˜

æ­¤æ¨¡çµ„å°‡é‡åŒ–å¾Œçš„ 8Ã—8 å€å¡Šé€²è¡Œï¼š
- **Zig-Zag æƒæ**
- **Run-Length Encoding (RLE)** å£“ç¸® 0
- **Huffman ç·¨ç¢¼** ç”Ÿæˆæœ€çµ‚ bitstream

---

### DC å€¼ç·¨ç¢¼æµç¨‹

1. è¨ˆç®—å·®å€¼ï¼š
   $$
   DC_{\text{diff}} = DC_{curr} - DC_{prev}
   $$
2. è¨ˆç®— bit sizeï¼ˆä»¥è¡¨ç¤ºå·®å€¼æ‰€éœ€ä½å…ƒæ•¸ï¼‰
3. æŸ¥ DC Huffman è¡¨ï¼Œä»¥ size ç‚º key æŸ¥è¡¨
4. åˆä½µï¼š`Huffman code + Value bits`

---

### AC å€¼ç·¨ç¢¼æµç¨‹

1. ä½¿ç”¨ RLEï¼šå°‡é€£çºŒ 0 ç·¨ç‚º `(Run, Value)`
2. è½‰ç‚º `(Run, Size)`ï¼Œå…¶ä¸­ Size ç‚º Value çš„ bit é•·åº¦
3. æŸ¥ AC Huffman è¡¨ï¼Œä»¥ `(Run << 4) + Size` ç‚º key
4. åˆä½µï¼š`Huffman code + Value bits`

---

### ç¯„ä¾‹

Zig-Zag è³‡æ–™ï¼š  
`DC = 4, AC = 0, 0, -5, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1...`

RLE:  
`(2, -5), (3, 2), (5, 1)`

Value bits + Size:

| Value | Bits | Size |
|-------|------|------|
| -5    | 101  | 3    |
| 2     | 10   | 2    |
| 1     | 1    | 1    |

Huffman Codes:

| (Run, Size) | Huffman |
|-------------|---------|
| (2,3)       | 11011   |
| (3,2)       | 1110010 |
| (5,1)       | 1111110 |

Bitstream çµ„åˆï¼š

| è³‡æ–™         | Huffman   | Value bits | çµæœ        |
|--------------|-----------|------------|-------------|
| DC: 4        | 010       | 100        | 010100      |
| AC: (2,-5)   | 11011     | 101        | 11011101    |
| AC: (3,2)    | 1110010   | 10         | 111001010   |
| AC: (5,1)    | 1111110   | 1          | 11111101    |

---

## ç¸½çµ

JPEG å£“ç¸®æµç¨‹æ¨¡çµ„è¨­è¨ˆï¼Œå…§å®¹åŒ…å«äº†ï¼š

- **Chroma ä¸‹æ¡æ¨£**ï¼ˆè³‡æ–™å£“ç¸®1/2ï¼‰
- **DCT + é‡åŒ–**ï¼ˆè½‰é »ç‡ã€å£“ç¸®ï¼‰
- **Zig-Zag + RLE + Huffman**ï¼ˆæœ€çµ‚ bitstream å£“ç¸®ï¼‰

æ­é… AXI-Stream èˆ‡ DMA å‚³è¼¸ï¼Œå¯¦ç¾é«˜é€Ÿã€ç¡¬é«”åŒ–çš„ JPEG å£“ç¸®æ‡‰ç”¨ã€‚
