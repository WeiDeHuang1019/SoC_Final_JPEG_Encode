



##  SDK 主程式說明

本程式負責在 Zynq SoC 上執行 **RGB → YCbCr → DMA 傳輸 → 儲存 .ycb** 的流程，並整合 DMA 傳輸與 AXI-Stream 的 JPEG 編碼 IP。以下針對 Input、Output、Method、Use Case、Attributes 作詳細說明。

---

### 1️⃣ Input（輸入）

| 名稱               | 說明                                                                                 |
| ---------------- | ---------------------------------------------------------------------------------- |
| `2048.rgb`       | 解析度 2048×2048 的 RGB 原始影像，格式為平面順序（Planar RGB），大小為 `2048×2048×3 = 12,582,912 bytes`。 |
| `rgb_data`       | RGB 影像會載入至 DDR 的 `0x01000000` 位置（TX\_BUFFER\_BASE）做為後續處理資料來源。                      |
| **DMA TX input** | 將 RGB 轉換後的 YCbCr（以 MCU 排列）透過 AXI DMA 傳送到 FPGA 端的影像處理 IP。                           |

---

### 2️⃣ Output（輸出）

| 名稱                | 說明                                                                                                         |
| ----------------- | ---------------------------------------------------------------------------------------------------------- |
| `output2.ycb`     | 最終產出影像資料，儲存為 `.ycb` 格式，內容為 4:2:0 格式的 YCbCr 資料，已經過 FPGA 處理（例如下採樣）。大小為 `384 × MCU_COUNT`（此例為 6220800 bytes）。 |
| **DMA RX output** | FPGA IP 處理後的資料透過 DMA 傳回，存放於 `0x02000000`（RX\_BUFFER\_BASE）位址開始的緩衝區中。                                       |

---

### 3️⃣ Method（流程與方法）

####  整體流程分為八步：

1. **初始化與 SD 卡掛載**：讀取影像與建立輸出檔案。
2. **RGB 檔案載入**：從 SD 卡讀取 `.rgb` 檔至記憶體。
3. **RGB → YCbCr 轉換**（浮點計算）：

   * `Y  = 0.299R + 0.587G + 0.114B`
   * `Cb = -0.169R - 0.331G + 0.5B + 128`
   * `Cr = 0.5R - 0.419G - 0.081B + 128`
4. **重新排列為 MCU（16×16區塊）**，並依序存成：

   * Y: 256 bytes
   * Cb: 256 bytes
   * Cr: 256 bytes
   * 合計 768 bytes / MCU
5. **DMA 初始化與設定**（不支援 Scatter-Gather 模式）。
6. **DMA 傳輸**：逐區塊進行傳送與接收，MCU 為單位。
7. **結果寫回 SD 卡**：將 RX buffer 的內容儲存為 `.ycb`。
8. **平台清除與結束執行**。

---

### 4️⃣ Use Case（用途場景）

| 場景           | 說明                                                            |
| ------------ | ------------------------------------------------------------- |
|  JPEG 壓縮前處理 | 本程式可搭配 FPGA JPEG Encoder IP，將 RGB 影像轉為 MCU 排列的 YCbCr 並傳送給壓縮器。 |
|  硬體驗證       | 驗證 DMA 傳輸通道是否正常工作，測試 AXI-Stream 接口 IP 的正確性與吞吐量。               |
|  高解析度影像處理   | 支援高達 2048×2048 的原始圖像處理，適用於工業應用影像前處理。                          |

---

### 5️⃣ Attributes（特性總結）

| 屬性                 | 說明                                                     |
| ------------------ | ------------------------------------------------------ |
|  支援高解析度          | 可處理任意 `16×16` 對齊的圖像尺寸（例如 128×128、1920×1080、2048×2048）。 |
|  高效 DMA 傳輸        | 單次傳送 768 Bytes MCU block，並可與硬體 AXI IP 流水線運作。           |
|  軟體可控制           | RGB → YCbCr 與 MCU 排列由 SDK 軟體控制，適合彈性調整與 debug。          |
|  AXI-Stream 雙向驗證 | 同時驗證 `TX (PL←PS)` 與 `RX (PL→PS)` 路徑完整性。                |
|  自動儲存結果          | 將處理結果寫入 SD 卡，便於後續 Python 或 PC 端解碼顯示。                   |

---

